<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Table Viewer</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
  <!-- Header -->
  <header class="bg-white shadow p-4">
    <h1 class="text-xl font-bold">Database Table Viewer</h1>
  </header>

  <!-- Main content -->
  <main class="flex-grow p-4 space-y-6">
    <p class="text-gray-700">
      View current data stored in the database. Read-only mode for testing/debugging.
    </p>

    <div id="tables" class="space-y-6"></div>
  </main>

  <!-- Footer with back link -->
  <footer class="p-4">
    <a href="admin.html" class="text-blue-600 hover:underline">‚Üê Back to Admin Portal</a>
  </footer>

  <script>
    const tables = ["iterations", "organization_units", "people", "person_roles"];

    async function loadTable(name) {
      try {
        const res = await fetch(`/api/admin/org-data-table?table=${name}`);
        const data = await res.json();

        const container = document.createElement("div");
        container.className = "bg-white rounded shadow p-4";

        const title = document.createElement("h2");
        title.className = "text-lg font-semibold mb-2";
        title.textContent = name;
        container.appendChild(title);

        if (data.success && data.rows.length > 0) {
          const table = document.createElement("table");
          table.className = "min-w-full border border-gray-300 text-sm";

          // Header
          const thead = document.createElement("thead");
          thead.className = "bg-gray-200";
          const headerRow = document.createElement("tr");
          Object.keys(data.rows[0]).forEach(key => {
            const th = document.createElement("th");
            th.className = "border px-2 py-1 text-left";
            th.textContent = key;
            headerRow.appendChild(th);
          });
          thead.appendChild(headerRow);
          table.appendChild(thead);

          // Body
          const tbody = document.createElement("tbody");
          data.rows.forEach(row => {
            const tr = document.createElement("tr");
            Object.values(row).forEach(value => {
              const td = document.createElement("td");
              td.className = "border px-2 py-1";
              td.textContent = value;
              tr.appendChild(td);
            });
            tbody.appendChild(tr);
          });
          table.appendChild(tbody);

          container.appendChild(table);
        } else {
          const msg = document.createElement("p");
          msg.className = "text-gray-500 italic";
          msg.textContent = "(No data)";
          container.appendChild(msg);
        }

        document.getElementById("tables").appendChild(container);
      } catch (err) {
        console.error("Error loading table", name, err);
      }
    }

    tables.forEach(loadTable);
  </script>
</body>
</html>

