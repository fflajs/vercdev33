let activeForm = null;

function showInlineSubunitForm(parentId, container) {
  // Close any previous form
  if (activeForm) {
    activeForm.remove();
    activeForm = null;
  }

  const form = document.createElement('div');
  form.className = 'ml-8 mt-2 p-2 border rounded bg-gray-50';

  const input = document.createElement('input');
  input.type = 'text';
  input.placeholder = 'Subunit name';
  input.className = 'border rounded px-2 py-1 mr-2';

  const submitBtn = document.createElement('button');
  submitBtn.textContent = 'Create';
  submitBtn.className = 'bg-green-500 text-white px-2 py-1 rounded';
  submitBtn.onclick = async () => {
    const name = input.value.trim();
    if (!name) return alert('Please enter a name.');

    const res = await fetch('/api/admin/create-org-unit', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, parent_id: parentId, iteration_id: currentIteration.id })
    });

    const data = await res.json();
    if (data.success) {
      loadIterationAndUnits(); // reload the tree
    } else {
      alert('Error: ' + data.message);
    }
  };

  const cancelBtn = document.createElement('button');
  cancelBtn.textContent = 'Cancel';
  cancelBtn.className = 'ml-2 bg-gray-400 text-white px-2 py-1 rounded';
  cancelBtn.onclick = () => {
    form.remove();
    activeForm = null;
  };

  form.appendChild(input);
  form.appendChild(submitBtn);
  form.appendChild(cancelBtn);

  container.appendChild(form);
  activeForm = form;
  input.focus();
}

