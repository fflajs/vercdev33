<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="w-full max-w-4xl bg-white p-8 rounded-lg shadow-lg">
    <h1 class="text-3xl font-bold mb-6 text-center">Admin Dashboard</h1>

    <!-- People Table -->
    <section class="mb-10">
      <h2 class="text-2xl font-semibold mb-4">Registered People</h2>
      <table class="min-w-full border border-gray-300">
        <thead>
          <tr class="bg-gray-200 text-left">
            <th class="px-4 py-2 border">ID</th>
            <th class="px-4 py-2 border">Name</th>
            <th class="px-4 py-2 border">Created At</th>
          </tr>
        </thead>
        <tbody id="people-table" class="divide-y divide-gray-200">
          <tr><td colspan="3" class="px-4 py-2 text-center text-gray-500">Loading...</td></tr>
        </tbody>
      </table>
    </section>

    <!-- Iterations Table -->
    <section>
      <h2 class="text-2xl font-semibold mb-4">Iterations</h2>
      <table class="min-w-full border border-gray-300">
        <thead>
          <tr class="bg-gray-200 text-left">
            <th class="px-4 py-2 border">ID</th>
            <th class="px-4 py-2 border">Name</th>
            <th class="px-4 py-2 border">Start Date</th>
            <th class="px-4 py-2 border">End Date</th>
            <th class="px-4 py-2 border">Question Set</th>
          </tr>
        </thead>
        <tbody id="iterations-table" class="divide-y divide-gray-200">
          <tr><td colspan="5" class="px-4 py-2 text-center text-gray-500">Loading...</td></tr>
        </tbody>
      </table>
    </section>
  </div>

  <script>
    async function loadPeople() {
      try {
        const res = await fetch('/api/admin/people');
        const data = await res.json();
        const table = document.getElementById('people-table');
        table.innerHTML = '';

        if (data.success && data.people.length > 0) {
          data.people.forEach(person => {
            const row = `<tr>
              <td class="px-4 py-2 border">${person.id}</td>
              <td class="px-4 py-2 border">${person.name}</td>
              <td class="px-4 py-2 border">${new Date(person.created_at).toLocaleString()}</td>
            </tr>`;
            table.innerHTML += row;
          });
        } else {
          table.innerHTML = '<tr><td colspan="3" class="px-4 py-2 text-center text-gray-500">No people found</td></tr>';
        }
      } catch (err) {
        console.error('Error loading people:', err);
      }
    }

    async function loadIterations() {
      try {
        const res = await fetch('/api/admin/iterations');
        const data = await res.json();
        const table = document.getElementById('iterations-table');
        table.innerHTML = '';

        if (data.success && data.iterations.length > 0) {
          data.iterations.forEach(iter => {
            const row = `<tr>
              <td class="px-4 py-2 border">${iter.id}</td>
              <td class="px-4 py-2 border">${iter.name}</td>
              <td class="px-4 py-2 border">${new Date(iter.start_date).toLocaleString()}</td>
              <td class="px-4 py-2 border">${iter.end_date ? new Date(iter.end_date).toLocaleString() : 'Active'}</td>
              <td class="px-4 py-2 border">${iter.question_set}</td>
            </tr>`;
            table.innerHTML += row;
          });
        } else {
          table.innerHTML = '<tr><td colspan="5" class="px-4 py-2 text-center text-gray-500">No iterations found</td></tr>';
        }
      } catch (err) {
        console.error('Error loading iterations:', err);
      }
    }

    loadPeople();
    loadIterations();
  </script>
</body>
</html>

