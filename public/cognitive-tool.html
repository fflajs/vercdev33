<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cognitive Tool</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900">

<div class="max-w-3xl mx-auto p-6">
  <h1 class="text-3xl font-bold mb-4">Cognitive Tool</h1>
  <p class="mb-6">Explore and manage cognitive processes.</p>

  <div id="context" class="mb-6 p-4 bg-gray-50 rounded border">
    <p><strong>User:</strong> <span id="ctx-user">—</span></p>
    <p><strong>Role:</strong> <span id="ctx-role">—</span></p>
    <p><strong>Unit:</strong> <span id="ctx-unit">—</span></p>
    <p><strong>Iteration:</strong> <span id="ctx-iter">—</span></p>
    <p><strong>Iteration ID:</strong> <span id="ctx-iterid">—</span></p>
    <p><strong>Question Set:</strong> <span id="ctx-qset">—</span></p>
  </div>

  <div class="mb-6">
    <h2 class="text-2xl font-semibold mb-2">Survey</h2>
    <p class="text-gray-500">Survey UI will go here (sliders, save/load).</p>
  </div>

  <div>
    <a href="portal.html" class="text-blue-600 hover:underline">← Back to Portal</a>
  </div>

  <details class="mt-6">
    <summary class="cursor-pointer font-semibold">Debug log (open to view)</summary>
    <pre id="debug-log" class="bg-black text-green-400 p-2 rounded mt-2 text-sm"></pre>
  </details>
</div>

<script>
function logDebug(msg, obj=null) {
  const log = document.getElementById("debug-log");
  log.textContent += `[${new Date().toISOString()}] [cognitive-tool] ${msg} ${obj ? JSON.stringify(obj) : ""}\n`;
}

async function loadContext() {
  const params = new URLSearchParams(window.location.search);
  const roleId = params.get("role_id");
  if (!roleId) {
    logDebug("No role_id provided in URL");
    return;
  }

  logDebug("Fetching role context for role_id=" + roleId);
  try {
    const res = await fetch(`/api/admin/get-role-context?role_id=${roleId}`);
    const data = await res.json();
    logDebug("GET result", data);

    if (data.success) {
      document.getElementById("ctx-user").textContent = data.user.name;
      document.getElementById("ctx-role").textContent = data.roleType;
      document.getElementById("ctx-unit").textContent = data.unitName;
      document.getElementById("ctx-iter").textContent = data.iterName;
      document.getElementById("ctx-iterid").textContent = data.iterId;
      document.getElementById("ctx-qset").textContent = data.qset;
    }
  } catch (err) {
    logDebug("Error fetching context", {error: err.message});
  }
}

loadContext();
</script>
</body>
</html>

