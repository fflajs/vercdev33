<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="w-full max-w-2xl bg-white p-8 rounded-lg shadow-lg">
    <h1 class="text-3xl font-bold mb-4 text-center">Welcome to the Portal</h1>

    <!-- Greeting -->
    <p class="text-gray-700 mb-6 text-center">
      Welcome, <span id="user-name" class="font-semibold">Unknown</span>!
    </p>

    <!-- Iteration info -->
    <div class="mb-6 text-center">
      <p class="text-gray-600">
        Current Active Iteration:
        <span id="iteration-name" class="font-semibold">-</span>
        (ID: <span id="iteration-id">-</span>)
      </p>
    </div>

    <!-- Actions -->
    <div class="flex flex-col sm:flex-row gap-4 justify-center">
      <a href="/visualizer.html"
         class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
        Login to Cognitive Visualizer
      </a>
      <a href="/analyzer.html"
         class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
        Analyze Descriptions
      </a>
      <button id="logout-btn"
              class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
        Logout
      </button>
    </div>
  </div>

  <script>
    // show logged-in user
    const userName = sessionStorage.getItem('personName');
    const personId = sessionStorage.getItem('personId');

    if (!userName || !personId) {
      // not logged in -> redirect
      window.location.href = '/index.html';
    } else {
      document.getElementById('user-name').textContent = userName;
    }

    // fetch active iteration
    async function loadIteration() {
      try {
        const response = await fetch('/api/active-iteration');
        const data = await response.json();

        if (data.success && data.iteration) {
          document.getElementById('iteration-name').textContent = data.iteration.name;
          document.getElementById('iteration-id').textContent = data.iteration.id;
        } else {
          document.getElementById('iteration-name').textContent = 'No active iteration';
          document.getElementById('iteration-id').textContent = '-';
        }
      } catch (err) {
        console.error('Failed to load iteration:', err);
        document.getElementById('iteration-name').textContent = 'Error';
        document.getElementById('iteration-id').textContent = '-';
      }
    }

    loadIteration();

    // logout clears sessionStorage
    document.getElementById('logout-btn').addEventListener('click', () => {
      sessionStorage.clear();
      window.location.href = '/index.html';
    });
  </script>
</body>
</html>

