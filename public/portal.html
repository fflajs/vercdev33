<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-6 bg-gray-100">
<div class="max-w-4xl mx-auto bg-white p-4 rounded shadow">
  <h1 class="text-2xl font-bold mb-4">User Portal</h1>
  <p class="mb-4">Welcome to the cognitive tools and analysis portal.</p>

  <div id="context" class="mb-4 text-sm text-gray-700"></div>

  <div class="space-y-3">
    <a id="cognitive" href="#" class="block bg-blue-500 text-white px-3 py-2 rounded text-center">Cognitive Tool</a>
    <a id="analyzer" href="#" class="block bg-green-500 text-white px-3 py-2 rounded text-center">Analyzer</a>
  </div>

  <div class="mt-6">
    <a href="index.html" class="text-blue-600">&larr; Back to Welcome</a>
  </div>

  <details class="mt-4">
    <summary>Debug log (open to view)</summary>
    <pre id="debug" class="bg-gray-100 p-2 text-xs overflow-auto h-40"></pre>
  </details>
</div>

<script>
const log=(msg,obj=null)=>{document.getElementById('debug').textContent+=`[portal] ${msg} ${obj?JSON.stringify(obj):''}\n`;};

async function init(){
  log("page loaded");
  const params=new URLSearchParams(window.location.search);
  const roleId=params.get('role_id');
  if(!roleId){log("Missing role_id");return;}
  log("Fetching role context for role_id="+roleId);

  const res=await fetch(`/api/admin/get-role-context?role_id=${roleId}`);
  const json=await res.json();
  log("GET result",json);
  if(!json.success){log("Error fetching context",json);return;}
  const c=json.context;

  document.getElementById('context').textContent=
    `User: ${c.user} — Role: ${c.roleType} — Unit: ${c.unitName} — Iteration: ${c.iterName} (ID: ${c.iterId}) — Question Set: ${c.qset}`;

  // Wire links
  document.getElementById('cognitive').href=`cognitive.html?role_id=${roleId}`;
  document.getElementById('analyzer').href=`analyze.html?role_id=${roleId}`;
}

window.addEventListener('load',init);
</script>
</body>
</html>

