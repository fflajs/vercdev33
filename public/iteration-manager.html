<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Iteration Manager</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
  <div class="max-w-5xl mx-auto p-6">
    <header class="mb-6">
      <h1 class="text-2xl font-bold">Iteration Manager</h1>
      <p class="text-gray-600 text-sm">Create and close iterations.</p>
    </header>

    <div class="bg-white rounded shadow p-6 space-y-4">
      <div id="current" class="text-sm text-gray-700"></div>
      <div class="flex gap-3">
        <button id="close" 
          class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
          Close Iteration
        </button>
        <button id="create" 
          class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
          Create New Iteration
        </button>
      </div>
    </div>

    <div class="mt-6">
      <a href="admin.html" class="text-blue-600 hover:underline">&larr; Back to Admin Portal</a>
    </div>

    <details class="mt-4">
      <summary class="cursor-pointer">Debug log (open to view)</summary>
      <pre id="debug" class="bg-gray-100 p-2 text-xs overflow-auto h-40"></pre>
    </details>
  </div>

  <script>
    const log = (msg, obj=null) => {
      document.getElementById("debug").textContent += `[iteration] ${msg} ${obj?JSON.stringify(obj):""}\n`;
    };

    async function loadCurrent() {
      const res = await fetch("/api/admin/active-iteration");
      const data = await res.json();
      if (data.success && data.iteration) {
        document.getElementById("current").textContent = 
          `Active Iteration: ${data.iteration.name} (ID: ${data.iteration.id})`;
      } else {
        document.getElementById("current").textContent = "No active iteration.";
      }
      log("Active iteration", data);
    }

    document.getElementById("close").addEventListener("click", async () => {
      await fetch("/api/admin/close-iteration", { method: "POST" });
      await loadCurrent();
    });

    document.getElementById("create").addEventListener("click", async () => {
      await fetch("/api/admin/create-iteration", { method: "POST" });
      await loadCurrent();
    });

    window.addEventListener("load", loadCurrent);
  </script>
</body>
</html>

